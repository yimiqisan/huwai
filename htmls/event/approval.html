{% extends ../frame.html %}
{% block static %}
	<script language="javascript" type="text/javascript">
		$(document).ready(function() {
			$('#nav-event').addClass("active");
			var isFirst = true;
			$('.btn-toggle').click(function () {
				var btn = $(this);
				btn.button('loading');
				var uncheck = btn.hasClass("btn-primary");
				var url = btn.attr("ajax-url");
				var args = {};
				args.owner = btn.attr("id").replace("btn-", "");
				args.she = "{{ eid }}";
				if (uncheck) {args.check = true;}
				$.postJSON(url, "POST", args, function(response) {
					if (response.error){
						return alert(response.error);
					}
					if (isFirst) {
						btn.button('complete');
						isFirst = false;
					} else {
						btn.button('reset');
						isFirst = true;
					}
					btn.toggleClass('btn-primary');
				});
			});
		})
	</script>
{% end %}

{% block bodyleft %}
	<div class="accordion" id="accordion">
		{% for u in userlist %}
		<div class="accordion-group">
			<div class="accordion-heading">
				<div class="accordion-toggle">
				<a class="pull-left" style="display:block;width:88%;height:28px;" data-toggle="collapse" data-parent="#accordion" href="#{{ u['id'] }}">
					{{ u.get('nick', None) }}
				</a>
				<button id="btn-{{ u['id'] }}" class="btn btn-toggle {% if not u['switch'] %}btn-primary{% end %}" ajax-url="/a/event/approval/" data-loading-text="提交中" data-complete-text="{% if u['switch'] %}通过{% else %}取消通过{% end %}">
					{% if u['switch'] %}取消通过{% else %}通过{% end %}
				</button>
				</div>
			</div>
			<div id="{{ u['id'] }}" class="accordion-body collapse" style="height: 0px;">
				<div class="accordion-inner hide">
					{{ u }}
				</div>
			</div>
		</div>
		{% end %}
	</div>
{% end %}
{% block bodyright %}
	<a class="btn" href="/event/{{ eid }}/">回到活动</a>
{% end %}